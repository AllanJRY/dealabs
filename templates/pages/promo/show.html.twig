{% extends 'base.html.twig' %}

{% block title %}Promo{% endblock %}

{% block body %}
    {% include('partials/component/navbar/category-route-navbar.html.twig') with {'good_plan_categories': deal.categories} %}
    <div class="container-fluid bg-secondary h-100">
        <div class="container mt-3">
            <div class="row">
                <div class="col-lg-9 col-12">
                    <div class="bg-white rounded">
                        <div class="row p-3">
                            <div class="col-4">
                                <a class="text-decoration-none text-dark" href="{{ deal.link }}" target="_blank">
                                    <img src="http://via.placeholder.com/300x180" alt="">
                                </a>
                            </div>
                            <div class="col-8">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn text-primary">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                    <button type="button" class="btn text-danger fw-bold">
                                        {{ deal | display_hot_value }}°
                                    </button>
                                    <button type="button" class="btn text-danger">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <h4 class="card-title fw-bold">{{ deal.title|capitalize }}</h4>
                                <p>
                                    <span class="text-danger">
                                        -
                                        {# -{{ deal.price }}€ #}
                                        {{ deal.promoType.type }}
                                    </span>
                                        {% if deal.partner %}
                                            <span class="text-muted">| Codes promo </span>
                                            <a class="text-primary text-decoration-none"
                                               href="#">{{ deal.partner.name }}</a>
                                        {% endif %}
                                </p>
                                <div class="row">
                                    <a class="btn btn-primary col-6" type="button" target="_blank"
                                       href="{{ deal.link }}">
                                        <span>Profiter du code</span>
                                        <i class="fas fa-external-link-square-alt"></i>
                                    </a>
                                    <a class="btn btn-outline-secondary col-4" type="button">
                                        <span>{{ deal.promoCode }}</span>
                                    </a>
                                    <button class="btn btn-primary col-2">
                                        <i class="fas fa-external-link-square-alt"></i>
                                    </button>
                                </div>
                                <div class="row justify-content-between align-items-center">
                                    <div class="col-lg-6 col-3">
                                        <p>{{ deal.author.username }}</p>
                                    </div>
                                    <div class="col-lg-6 col-9 row">
                                        <a class="btn text-dark text-decoration-none col-3 border-dark border-1 m-3"
                                           href="{{ path('good_plan_show',{slug : deal.slug}) }}" type="button">
                                            <i class="fas fa-comment"></i>
                                            <span>{{ deal.comments|length }}</span>
                                        </a>
                                        <a class="btn btn-primary col-6 m-3" type="button" target="_blank"
                                           href="{{ deal.link }}">
                                            <span>Voir le deal</span>
                                            <i class="fas fa-external-link-square-alt"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row m-3 border rounded">
                            {% set time = date(deal.createdAt).diff(date('now')) %}
                            <p class="text-muted align-items-center m-3">
                                <i class="far fa-clock"></i>
                                <span>{{ deal.createdAt|date('d M Y') }}</span>
                                {% if time.h > 0 and time.d == 0 and time.m == 0 %}
                                    <span>( il y a {{ time.h }} h et {{ time.i }} )</span>
                                {% elseif time.s > 0 and time.h == 0 and time.d == 0 and time.m == 0 %}
                                    <span>( il y a {{ time.i }} )</span>
                                {% endif %}
                            </p>
                        </div>
                        <p class="p-3">
                            {{ deal.description }}
                        </p>
                    </div>


                    <div class="bg-white rounded p-3">
                        {% for comment in deal.comments | sort((commentA, commentB) => commentA.createdAt < commentB.createdAt) %}
                            <div class="row">
                                <div class="col-2">
                                    <img src="http://via.placeholder.com/300x180" class="img-fluid rounded-circle"
                                         alt="">
                                </div>
                                <div class="col-10">
                                    <div class="row">
                                        <p>
                                            <span>
                                                {{ comment.author.username }}
                                            </span>
                                            <span>
                                                - {{ comment.createdAt | date('d/m/Y H:i', "Europe/Paris") }}
                                            </span>
                                        </p>
                                        <p>{{ comment.content }}</p>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <div class="bg-white rounded p-3">
                        {% if app.user %}
                            {{ form_start(commentForm) }}
                            {{ form_widget(commentForm.content) }}
                            <input type="submit" value="Envoyer">
                            {{ form_end(commentForm) }}
                        {% endif %}
                    </div>
                </div>
                <div class="col-lg-3 col-12">

                </div>
            </div>
        </div>
    </div>
{% endblock %}